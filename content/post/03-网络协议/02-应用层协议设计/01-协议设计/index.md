---
title: "网络协议设计 — 1 — 一些基本概念"
description: 
date: 2024-10-23
image: 
math: 
license: 
hidden: false
comments: true
draft: false
categories:
    - 网络协议设计
---

- [1. 流式协议](#1-流式协议)
- [2. 如何解决边界](#2-如何解决边界)
  - [2.1. 固定包长度](#21-固定包长度)
  - [2.2. 指定包结束标志](#22-指定包结束标志)
  - [2.3. 封装一套协议（协议头+数据）](#23-封装一套协议协议头数据)
- [3. 解包与包数据处理](#3-解包与包数据处理)
- [4.](#4)
- [5.](#5)


# 1. 流式协议
&emsp;&emsp;TCP提供一种可靠传输方式。通过序列号和包重传确认机制保证数据包的有序，不会丢包或包乱序，并且数据一定被正确发到目的地。如果我们使用UDP协议，但是不能接受少量丢包，那就要在UDP的基础去现类似TCP的有序和可靠传输机制了（例如 RTP、RUDP）。但是TCP作为`流式协议`，或者是类似协议，它证数据有序送达，但是数据流从那里开始，从那里结束，这就不是人家的本职工作了，也就是说，我们从传输层拿到数据后，要自行处理数据的`边界`。


# 2. 如何解决边界       
关于边界问题，有两种情况：`粘包`、`半包`。   
- 粘包： 多个包裹连接在一起，也可能不是整数个包。   
- 半包： 只收到一个包的一部分。     

无论是半包还是粘包问题，问题都出在`流的边界`上，常用的解决办法有3种：`固定包长度`、`指定包结束标志`、`封装一套协议（协议头+数据）`。  
## 2.1. 固定包长度 
&emsp;&emsp;数据包固定大小，这样虽然灵活性差，但是简单，它的缺点就是，当数据长度小于包长度时，需要使用特定字符填充，例如“\0”，必须和正常数据区分开。当数据报长度大于包长度时，需要分包，发送端需要分包，接收端需要组包。  

## 2.2. 指定包结束标志 
&emsp;&emsp;就是指定特定的符号或者符号组合作为包结束标志，例如FTP、SMTP协议，使用“\r\n”表示结束，接受端处理包时，遇到“\r\n”就认为获取到了一个包。如果传输一些命令之类的数据，可以使用这种方式，他的缺点就是，但数据内容需要使用包结束标志时，就需要额外作转义处理了。  

## 2.3. 封装一套协议（协议头+数据）  
&emsp;&emsp;这种最正式了，照葫芦画瓢设计一个结构体来表示协议头，这个结构体要包含表明数据类型，数据长度，等等。后面章节会以这种方式讲解代码设计。

# 3. 解包与包数据处理
这里我们简单的理解以下，接收数据并处理的流程：   

图片
https://cpp1024.com/protocol/7-3-%E8%A7%A3%E5%8C%85%E4%B8%8E%E5%A4%84%E7%90%86.html
# 4. 

https://cpp1024.com/protocol/7-4-%E4%BB%8E-struct-%E5%88%B0-TLV%E2%80%94%E2%80%94%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%BC%94%E5%8C%96%E5%8E%86%E5%8F%B2.html


# 5. 

https://cpp1024.com/protocol/7-5-%E9%80%9A%E4%BF%A1%E5%8D%8F%E8%AE%AE%E8%AE%BE%E8%AE%A1%E6%97%B6%E7%9A%84%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9.html